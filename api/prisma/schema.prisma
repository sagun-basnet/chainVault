generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model blockchainlog {
  id         Int                  @id @default(autoincrement())
  fileId     Int
  userId     Int
  action     blockchainlog_action
  hash       String
  txHash     String?
  timestamp  DateTime             @default(now())
  file       file                 @relation(fields: [fileId], references: [id], onDelete: Cascade, map: "BlockchainLog_fileId_fkey")
  user       user                 @relation(fields: [userId], references: [id], onDelete: Cascade, map: "BlockchainLog_userId_fkey")
  sharedlink sharedlink[]

  @@index([fileId], map: "BlockchainLog_fileId_fkey")
  @@index([userId], map: "BlockchainLog_userId_fkey")
}

model file {
  id            Int             @id @default(autoincrement())
  name          String
  path          String
  size          Int
  type          String
  category      String?
  userId        Int
  embedding     Json?
  createdAt     DateTime        @default(now())
  blockchainlog blockchainlog[]
  user          user            @relation(fields: [userId], references: [id], onDelete: Cascade, map: "File_userId_fkey")

  tags       filetag[]
  sharedlink sharedlink[]

  @@index([userId], map: "File_userId_fkey")
}

model filetag {
  id     Int  @id @default(autoincrement())
  fileId Int
  tagId  Int
  file   file @relation(fields: [fileId], references: [id], onDelete: Cascade, map: "FileTag_fileId_fkey")
  tag    tag  @relation(fields: [tagId], references: [id], onDelete: Cascade, map: "FileTag_tagId_fkey")

  @@unique([fileId, tagId], map: "FileTag_fileId_tagId_key")
  @@index([tagId], map: "FileTag_tagId_fkey")
}

model sharedlink {
  id              Int                   @id @default(autoincrement())
  fileId          Int
  userId          Int
  token           String                @unique(map: "SharedLink_token_key")
  password        String?
  permission      sharedlink_permission
  expiresAt       DateTime?
  createdAt       DateTime              @default(now())
  blockchainLogId Int?
  blockchainlog   blockchainlog?        @relation(fields: [blockchainLogId], references: [id], map: "SharedLink_blockchainLogId_fkey")
  file            file                  @relation(fields: [fileId], references: [id], onDelete: Cascade, map: "SharedLink_fileId_fkey")
  user            user                  @relation(fields: [userId], references: [id], onDelete: Cascade, map: "SharedLink_userId_fkey")

  @@index([blockchainLogId], map: "SharedLink_blockchainLogId_fkey")
  @@index([fileId], map: "SharedLink_fileId_fkey")
  @@index([userId], map: "SharedLink_userId_fkey")
}

model tag {
  id      Int       @id @default(autoincrement())
  name    String    @unique(map: "Tag_name_key")
  filetag filetag[]
}

model user {
  id            Int             @id @default(autoincrement())
  name          String
  email         String          @unique(map: "User_email_key")
  password      String
  role          user_role       @default(USER)
  createdAt     DateTime        @default(now())
  blockchainlog blockchainlog[]
  file          file[]
  sharedlink    sharedlink[]
}

enum blockchainlog_action {
  UPLOAD
  DELETE
  UPDATE
  SHARE
}

enum user_role {
  USER
  ADMIN
}

enum sharedlink_permission {
  VIEW_ONLY
  DOWNLOAD
}
